<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: app/page.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"Veronica API","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">Veronica API</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Application#data">
            <span class="title">
                <a href="Application_data.html">Application#data</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#data.get"><a href="Application_data.html#.get">get</a></li>
            
                <li data-name="Application#data.set"><a href="Application_data.html#.set">set</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="Application#data.event:change"><a href="Application_data.html#.event:change">change</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#layout">
            <span class="title">
                <a href="Application_layout.html">Application#layout</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#layout.add"><a href="Application_layout.html#.add">add</a></li>
            
                <li data-name="Application#layout.change"><a href="Application_layout.html#.change">change</a></li>
            
                <li data-name="Application#layout.get"><a href="Application_layout.html#.get">get</a></li>
            
                <li data-name="Application#layout.init"><a href="Application_layout.html#.init">init</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="Application#layout.event:layoutChanged"><a href="Application_layout.html#.event:layoutChanged">layoutChanged</a></li>
            
                <li data-name="Application#layout.event:layoutChanging"><a href="Application_layout.html#.event:layoutChanging">layoutChanging</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#module">
            <span class="title">
                <a href="Application_module.html">Application#module</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#module.add"><a href="Application_module.html#.add">add</a></li>
            
                <li data-name="Application#module.apply"><a href="Application_module.html#.apply">apply</a></li>
            
                <li data-name="Application#module.create"><a href="Application_module.html#.create">create</a></li>
            
                <li data-name="Application#module.get"><a href="Application_module.html#.get">get</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#page">
            <span class="title">
                <a href="Application_page.html">Application#page</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#page.active"><a href="Application_page.html#.active">active</a></li>
            
                <li data-name="Application#page.add"><a href="Application_page.html#.add">add</a></li>
            
                <li data-name="Application#page.change"><a href="Application_page.html#.change">change</a></li>
            
                <li data-name="Application#page.getCurrentName"><a href="Application_page.html#.getCurrentName">getCurrentName</a></li>
            
                <li data-name="Application#page.start"><a href="Application_page.html#.start">start</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="Application#page.event:pageLoaded"><a href="Application_page.html#.event:pageLoaded">pageLoaded</a></li>
            
                <li data-name="Application#page.event:pageLoading"><a href="Application_page.html#.event:pageLoading">pageLoading</a></li>
            
                <li data-name="Application#page.event:pageNotFound"><a href="Application_page.html#.event:pageNotFound">pageNotFound</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#request">
            <span class="title">
                <a href="Application_request.html">Application#request</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#request.get"><a href="Application_request.html#.get">get</a></li>
            
                <li data-name="Application#request.getComplex"><a href="Application_request.html#.getComplex">getComplex</a></li>
            
                <li data-name="Application#request.getJSON"><a href="Application_request.html#.getJSON">getJSON</a></li>
            
                <li data-name="Application#request.post"><a href="Application_request.html#.post">post</a></li>
            
                <li data-name="Application#request.postComplex"><a href="Application_request.html#.postComplex">postComplex</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#router">
            <span class="title">
                <a href="Application_router.html">Application#router</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Application#router.base"><a href="Application_router.html#.base">base</a></li>
            
                <li data-name="Application#router.instance"><a href="Application_router.html#.instance">instance</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#router.create"><a href="Application_router.html#.create">create</a></li>
            
                <li data-name="Application#router.navigate"><a href="Application_router.html#.navigate">navigate</a></li>
            
                <li data-name="Application#router.start"><a href="Application_router.html#.start">start</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#sandboxes">
            <span class="title">
                <a href="Application_sandboxes.html">Application#sandboxes</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#sandboxes.create"><a href="Application_sandboxes.html#.create">create</a></li>
            
                <li data-name="Application#sandboxes.get"><a href="Application_sandboxes.html#.get">get</a></li>
            
                <li data-name="Application#sandboxes.getByName"><a href="Application_sandboxes.html#.getByName">getByName</a></li>
            
                <li data-name="Application#sandboxes.remove"><a href="Application_sandboxes.html#.remove">remove</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#view">
            <span class="title">
                <a href="Application_view.html">Application#view</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Application#view.base"><a href="Application_view.html#.base">base</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#view.define"><a href="Application_view.html#.define">define</a></li>
            
                <li data-name="Application#view.register"><a href="Application_view.html#.register">register</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Application#widget">
            <span class="title">
                <a href="Application_widget.html">Application#widget</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Application#widget.isLoading"><a href="Application_widget.html#.isLoading">isLoading</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#widget.clear"><a href="Application_widget.html#.clear">clear</a></li>
            
                <li data-name="Application#widget.package"><a href="Application_widget.html#.package">package</a></li>
            
                <li data-name="Application#widget.register"><a href="Application_widget.html#.register">register</a></li>
            
                <li data-name="Application#widget.start"><a href="Application_widget.html#.start">start</a></li>
            
                <li data-name="Application#widget.stop"><a href="Application_widget.html#.stop">stop</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="Application#widget.event:widgetLoaded"><a href="Application_widget.html#.event:widgetLoaded">widgetLoaded</a></li>
            
                <li data-name="Application#widget.event:widgetsLoaded"><a href="Application_widget.html#.event:widgetsLoaded">widgetsLoaded</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="veronica">
            <span class="title">
                <a href="veronica.html">veronica</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="veronica.$"><a href="veronica.html#.$">$</a></li>
            
                <li data-name="veronica._"><a href="veronica.html#._">_</a></li>
            
                <li data-name="veronica.app"><a href="veronica.html#.app">app</a></li>
            
                <li data-name="veronica.ext"><a href="veronica.html#.ext">ext</a></li>
            
                <li data-name="veronica.helper"><a href="veronica.html#.helper">helper</a></li>
            
                <li data-name="veronica.loader"><a href="veronica.html#.loader">loader</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="veronica.createApp"><a href="veronica.html#.createApp">createApp</a></li>
            
                <li data-name="veronica.getConfig"><a href="veronica.html#.getConfig">getConfig</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="veronica.enums">
            <span class="title">
                <a href="veronica.enums.html">veronica.enums</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="veronica.enums.hostType"><a href="veronica.enums.html#.hostType">hostType</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Veronica.loader">
            <span class="title">
                <a href="Veronica.loader.html">Veronica.loader</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Veronica.loader.require"><a href="Veronica.loader.html#.require">require</a></li>
            
                <li data-name="Veronica.loader.useGlobalRequire"><a href="Veronica.loader.html#.useGlobalRequire">useGlobalRequire</a></li>
            
                <li data-name="Veronica.loader.useGlobalRequirejs"><a href="Veronica.loader.html#.useGlobalRequirejs">useGlobalRequirejs</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="veronica.util">
            <span class="title">
                <a href="veronica.util.html">veronica.util</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="veronica.util.camelize"><a href="veronica.util.html#.camelize">camelize</a></li>
            
                <li data-name="veronica.util.decamelize"><a href="veronica.util.html#.decamelize">decamelize</a></li>
            
                <li data-name="veronica.util.qsToJSON"><a href="veronica.util.html#.qsToJSON">qsToJSON</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Application">
            <span class="title">
                <a href="Application.html">Application</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Application#config"><a href="Application.html#config">config</a></li>
            
                <li data-name="Application#core"><a href="Application.html#core">core</a></li>
            
                <li data-name="Application#lang"><a href="Application.html#lang">lang</a></li>
            
                <li data-name="Application#name"><a href="Application.html#name">name</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Application#emit"><a href="Application.html#emit">emit</a></li>
            
                <li data-name="Application#launch"><a href="Application.html#launch">launch</a></li>
            
                <li data-name="Application#mixin"><a href="Application.html#mixin">mixin</a></li>
            
                <li data-name="Application#stop"><a href="Application.html#stop">stop</a></li>
            
                <li data-name="Application#use"><a href="Application.html#use">use</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="Application#event:appStarted"><a href="Application.html#event:appStarted">appStarted</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="Logger">
            <span class="title">
                <a href="Logger.html">Logger</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Logger#_time"><a href="Logger.html#_time">_time</a></li>
            
                <li data-name="Logger#enable"><a href="Logger.html#enable">enable</a></li>
            
                <li data-name="Logger#error"><a href="Logger.html#error">error</a></li>
            
                <li data-name="Logger#info"><a href="Logger.html#info">info</a></li>
            
                <li data-name="Logger#log"><a href="Logger.html#log">log</a></li>
            
                <li data-name="Logger#setName"><a href="Logger.html#setName">setName</a></li>
            
                <li data-name="Logger#warn"><a href="Logger.html#warn">warn</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Module">
            <span class="title">
                <a href="Module.html">Module</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Module#config"><a href="Module.html#config">config</a></li>
            
                <li data-name="Module#execution"><a href="Module.html#execution">execution</a></li>
            
                <li data-name="Module#name"><a href="Module.html#name">name</a></li>
            
                <li data-name="Module#path"><a href="Module.html#path">path</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Module#addExtension"><a href="Module.html#addExtension">addExtension</a></li>
            
                <li data-name="Module#addLayout"><a href="Module.html#addLayout">addLayout</a></li>
            
                <li data-name="Module#addPage"><a href="Module.html#addPage">addPage</a></li>
            
                <li data-name="Module#addSource"><a href="Module.html#addSource">addSource</a></li>
            
                <li data-name="Module#apply"><a href="Module.html#apply">apply</a></li>
            
                <li data-name="Module#loadEntry"><a href="Module.html#loadEntry">loadEntry</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Sandbox">
            <span class="title">
                <a href="Sandbox.html">Sandbox</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Sandbox#_id"><a href="Sandbox.html#_id">_id</a></li>
            
                <li data-name="Sandbox#app"><a href="Sandbox.html#app">app</a></li>
            
                <li data-name="Sandbox#name"><a href="Sandbox.html#name">name</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Sandbox#emit"><a href="Sandbox.html#emit">emit</a></li>
            
                <li data-name="Sandbox#getConfig"><a href="Sandbox.html#getConfig">getConfig</a></li>
            
                <li data-name="Sandbox#getHost"><a href="Sandbox.html#getHost">getHost</a></li>
            
                <li data-name="Sandbox#log"><a href="Sandbox.html#log">log</a></li>
            
                <li data-name="Sandbox#off"><a href="Sandbox.html#off">off</a></li>
            
                <li data-name="Sandbox#on"><a href="Sandbox.html#on">on</a></li>
            
                <li data-name="Sandbox#once"><a href="Sandbox.html#once">once</a></li>
            
                <li data-name="Sandbox#startWidgets"><a href="Sandbox.html#startWidgets">startWidgets</a></li>
            
                <li data-name="Sandbox#stop"><a href="Sandbox.html#stop">stop</a></li>
            
                <li data-name="Sandbox#stopChildren"><a href="Sandbox.html#stopChildren">stopChildren</a></li>
            
                <li data-name="Sandbox#stopListening"><a href="Sandbox.html#stopListening">stopListening</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="View">
            <span class="title">
                <a href="View.html">View</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="View#_bind"><a href="View.html#_bind">_bind</a></li>
            
                <li data-name="View#_customDestory"><a href="View.html#_customDestory">_customDestory</a></li>
            
                <li data-name="View#aspect"><a href="View.html#aspect">aspect</a></li>
            
                <li data-name="View#baseModel"><a href="View.html#baseModel">baseModel</a></li>
            
                <li data-name="View#binds"><a href="View.html#binds">binds</a></li>
            
                <li data-name="View#cid"><a href="View.html#cid">cid</a></li>
            
                <li data-name="View#className"><a href="View.html#className">className</a></li>
            
                <li data-name="View#defaults"><a href="View.html#defaults">defaults</a></li>
            
                <li data-name="View#delegateModelEvents"><a href="View.html#delegateModelEvents">delegateModelEvents</a></li>
            
                <li data-name="View#enhance"><a href="View.html#enhance">enhance</a></li>
            
                <li data-name="View#init"><a href="View.html#init">init</a></li>
            
                <li data-name="View#initAttr"><a href="View.html#initAttr">initAttr</a></li>
            
                <li data-name="View#listen"><a href="View.html#listen">listen</a></li>
            
                <li data-name="View#options"><a href="View.html#options">options</a></li>
            
                <li data-name="View#resize"><a href="View.html#resize">resize</a></li>
            
                <li data-name="View#subscribe"><a href="View.html#subscribe">subscribe</a></li>
            
                <li data-name="View#switchable"><a href="View.html#switchable">switchable</a></li>
            
                <li data-name="View#template"><a href="View.html#template">template</a></li>
            
                <li data-name="View#views"><a href="View.html#views">views</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="View#active"><a href="View.html#active">active</a></li>
            
                <li data-name="View#attr"><a href="View.html#attr">attr</a></li>
            
                <li data-name="View#destroy"><a href="View.html#destroy">destroy</a></li>
            
                <li data-name="View#hide"><a href="View.html#hide">hide</a></li>
            
                <li data-name="View#initialize"><a href="View.html#initialize">initialize</a></li>
            
                <li data-name="View#listenToDelay"><a href="View.html#listenToDelay">listenToDelay</a></li>
            
                <li data-name="View#pub"><a href="View.html#pub">pub</a></li>
            
                <li data-name="View#refresh"><a href="View.html#refresh">refresh</a></li>
            
                <li data-name="View#render"><a href="View.html#render">render</a></li>
            
                <li data-name="View#replaceTpl"><a href="View.html#replaceTpl">replaceTpl</a></li>
            
                <li data-name="View#setTriggers"><a href="View.html#setTriggers">setTriggers</a></li>
            
                <li data-name="View#show"><a href="View.html#show">show</a></li>
            
                <li data-name="View#startWidgets"><a href="View.html#startWidgets">startWidgets</a></li>
            
                <li data-name="View#sub"><a href="View.html#sub">sub</a></li>
            
                <li data-name="View#unsub"><a href="View.html#unsub">unsub</a></li>
            
                <li data-name="View#view"><a href="View.html#view">view</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            <span class="subtitle">Events</span>
            
                <li data-name="View#event:rendered"><a href="View.html#event:rendered">rendered</a></li>
            
                <li data-name="View#event:setTriggers"><a href="View.html#event:setTriggers">setTriggers</a></li>
            
            </ul>
        </li>
    
        <li class="item" data-name="Widget">
            <span class="title">
                <a href="Widget.html">Widget</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Widget#name"><a href="Widget.html#name">name</a></li>
            
                <li data-name="Widget#options"><a href="Widget.html#options">options</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="app_page.js.html">Source: app/page.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>
define([], function () {

    return function (app) {
        var core = app.core;
        var $ = app.core.$;
        var _ = app.core._;
        var appConfig = app.config;

        /**
         * 页面配置项预处理
         */
        function preprocessPageConfig(pageConfig) {
            if (pageConfig.widgets &amp;&amp; pageConfig.widgets.length !== 0) {
                _.each(pageConfig.widgets, function (widget, j) {
                    // 将带字符串widget配置转换成配置对象
                    if (_.isString(widget)) {
                        var sep = widget.split('@');
                        pageConfig.widgets[j] = {
                            name: sep[0],
                            options: {
                                host: sep[1] || appConfig.page.defaultHost,
                                _source: sep[2] || appConfig.page.defaultSource
                            }
                        };
                    }
                });
            }
            return pageConfig;
        }

        /**
         * 页面相关
         * @namespace
         * @memberOf Application#
         */
        var page = {
            _pages: {
                // 页面的基类
                '_common': {
                    widgets: []
                },
                currPageName: ''
            },
            _changeTitle: function () { },
            _processInherit: function (pageConfig) {
                var me = this;
                var parentsWidgets = _(pageConfig.inherit).map(function (parentName) {
                    return me.get(parentName).widgets;
                });
                parentsWidgets.unshift(pageConfig.widgets);
                return _.uniq(_.union.apply(_, parentsWidgets), false, function (item) {
                    if (item.options &amp;&amp; item.options.el) return item.options.el;  // 确保一个元素上只有一个插件
                    return item.name + item.options.host;  // 确保一个父元素下，只有一个同样的插件
                });
            },
            isCurrent: function (pageName) {
                return this._pages.currPageName === 'default' || this._pages.currPageName === pageName;
            },
            /**
             * 获取当前页面名称
             */
            getCurrentName: function () {
                return this.get('currPageName');
            },
            /**
             * 加载页面
             * @param {string} name - 页面名称
             * @private
             */
            _load: function (name, config, params) {
                var me = this;
                var widgetsConfig = this._processInherit(config);
                if (params) {  // 如果传入了页面查询字符串参数，则为每一个 widget config 附加配置参数
                    var paramsObj = app.core.util.qsToJSON(params);
                    if (paramsObj) {
                        _.each(widgetsConfig, function (conf) {
                            conf.options = $.extend(conf.options, paramsObj);
                        });
                    }
                }
                var currPageName = this.getCurrentName();
                var currPageConfig;
                var dfd = $.Deferred();
                var proms = core.util.donePromise();

                /**
                 * **消息：** 页面加载中
                 * @event Application#page.pageLoading
                 * @param {string} name - 页面名称
                 */
                app.emit('pageLoading', name);

                // 在页面加载之前，进行布局的预加载
                if (currPageName === '' ||
                    (currPageConfig = this.get(currPageName)) &amp;&amp; currPageConfig.layout !== config.layout) {

                    proms = app.layout.change(config.layout).done(function () {

                        /**
                         * **消息：** 布局加载完毕
                         * @event Application#layout.layoutChanged
                         * @param {string} name - 布局名称
                         */
                        app.emit('layoutChanged', config.layout);
                    }).fail(function () {
                        dfd.reject();
                    });
                }

                proms.done(function () {
                    me._pages.currPageName = name;

                    app.sandbox.startWidgets(widgetsConfig, name).done(function () {
                        // 切换页面后进行垃圾回收
                        app.widget.recycle();

                        /**
                         * **消息：** 页面加载完毕
                         * @event Application#page.pageLoaded
                         * @param {string} name - 页面名称
                         */
                        app.emit('pageLoaded', name);
                        dfd.resolve();
                    });
                });

                return dfd.promise();
            },
            /**
             * 活动
             */
            active: function (name) {
                if (name) {
                    return this.change(name);
                } else {
                    name = this.get('currPageName');
                }
                return name;
            },
            // 获取默认配置
            defaultConfig: function (pageName) {
                var data = app.page.parseName(pageName);
                return {
                    widgets: [
                        data.fullname + '@' + app.config.page.defaultHost + '@' + data.module
                    ]
                };
            },
            parseName: function (pageName) {

                var result;
                var token = pageName.indexOf('/') > -1 ? '/' : '-';
                var arr = pageName.split(token);
                // TODO: 这里
                switch (arr.length) {
                    case 1:
                        result = {
                            module: 'basic',
                            controller: 'Home',
                            action: arr[0]
                        };
                        break;
                    case 2:
                        result = {
                            module: 'basic',
                            controller: arr[0],
                            action: arr[1]
                        };
                        break;
                    case 3:
                        result = {
                            module: arr[0],
                            controller: arr[1],
                            action: arr[2]
                        };
                        break;
                }

                result.fullname = result.module + '-' + result.controller + '-' + result.action;
                return result;
            },
            // 获取页面配置
            get: function (name) {
                var config = this._pages[name];
                return config;
            },
            /**
             * 添加页面配置组
             * @param {object|array} configs - 页面配置组（当为单个配置时，可以不用数组）
             */
            add: function (configs) {
                var me = this;
                if (!_.isArray(configs)) {
                    configs = [configs];
                }
                _.each(configs, function (config) {
                    _(config).each(function (item, pageName) {
                        item = preprocessPageConfig(item);

                        config[pageName] = $.extend({
                            name: '',
                            layout: appConfig.page.defaultLayout,
                            widgets: [{
                                name: pageName,
                                options: {
                                    _host: appConfig.page.defaultHost,
                                    _source: appConfig.page.defaultSource
                                }
                            }],
                            inherit: [appConfig.page.defaultInherit]
                        }, item);
                    });

                    $.extend(me._pages, config);
                });

                return this;
            },
            /**
             * 启动页面
             * @param {boolean} [initLayout=false] - 是否初始化布局
             * @fires Application#appStarted
             */
            start: function (initLayout) {
                if (initLayout) {
                    app.layout.init();
                }
                app.router.start();
                /**
                 * **消息：** 应用程序页面启动完成
                 * @event Application#appStarted
                 */
                app.emit('appStarted');
            },
            /**
             * 改变页面
             * @param {string} name - 页面名称
             * @fires Application#page.pageNotFound
             * @fires Application#page.pageLoading
             * @fires Application#layout.layoutChanged
             * @fires Application#page.pageLoaded
             */
            change: function (name, params) {
                var page = this;
                var config = page.get(name);
                var proms = core.util.donePromise(config);

                // 自动生成页面配置
                if (!config &amp;&amp; app.config.autoBuildPage) {
                    var obj = {};
                    obj[name] = page.defaultConfig(name);
                    page.add(obj);
                    config = page.get(name);
                }

                // 未找到页面配置，则从该路径后台读取页面配置
                if (!config) {

                    var pageUrl = name.replace('-', '/');
                    proms = $.getJSON(pageUrl);
                }

                proms.done(function (config) {
                    page._load(name, config, params);
                }).fail(function () {
                    /**
                     * **消息：** 页面未找到
                     * @event Application#page.pageNotFound
                     * @param {string} name - 页面名称
                     */
                    app.emit('pageNotFound', name);
                });
            }
        }

        app.page = page;

    };
});
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.1</a> on Mon Jul 20 2015 14:07:22 GMT+0800 (中国标准时间)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
